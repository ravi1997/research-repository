<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    {% block highwire %} {% endblock %}

    <link
      rel="icon"
      href="{{ url_for('static', filename='assets/favicon.ico') }}"
    />

    <link
      rel="apple-touch-icon"
      sizes="192x192"
      href="{{ url_for('static', filename='assets/android-chrome-192x192.png') }}"
    />
    <link
      rel="apple-touch-icon"
      sizes="512x512"
      href="{{ url_for('static', filename='assets/android-chrome-512x512.png') }}"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="{{ url_for('static', filename='assets/apple-touch-icon.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="{{ url_for('static', filename='assets/favicon-32x32.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="{{ url_for('static', filename='assets/favicon-16x16.png') }}"
    />
    <link
      rel="manifest"
      href="{{ url_for('static', filename='assets/site.webmanifest') }}"
    />

    <link
      rel="stylesheet"
      href="{{url_for('static',filename='style/style.css')}}"
    />
    <!-- 
    <link
      rel="stylesheet"
      href="{{url_for('static',filename='style/flowbite.min.css')}}"
    /> -->
    <link
      rel="stylesheet"
      href="{{url_for('static',filename='style/toastify.css')}}"
    />

    <link
      rel="stylesheet"
      href="{{url_for('static',filename='dist/css/output.css')}}"
    />
    {% if title %}
    <title>{{ title }} - AIIMS Research Publication Repository</title>
    {% else %}
    <title>AIIMS Research Publication Repository</title>
    {% endif %}

    <script>
      // Set theme on HTML page load
      if (localStorage.getItem("theme") === "dark") {
        document.getElementsByTagName("html")[0].classList.add("dark");
      }
    </script>
  </head>

  <body
    class="min-w-[360px] bg-slate-100 text-stone-700 dark:bg-gray-800 dark:text-teal-100"
  >
    <header>
      <nav
        class="h-16 content-center bg-slate-200 px-2 py-2 text-gray-700 xl:py-0 dark:bg-slate-700"
        id="navbarBgfullwidth"
      >
        <div
          class="container mx-auto flex w-full flex-wrap items-center justify-between"
          id="navbarContainedContent"
        >
          <a href="/">
            <div
              class="flex items-center text-red-800 dark:text-teal-300"
              id="leftLogoTitle"
            >
              <div id="brandLogo" class="mr-4 h-10 w-10">
                {% include 'logosvg.html' %}
              </div>
              <div class="text-lg xl:text-xl">
                Research Publication Repository
              </div>
            </div>
          </a>
          <button
            id="mainSiteNavToggle"
            class="h-10 text-red-800 xl:hidden dark:text-teal-300"
            aria-label="Main navigation"
            onclick="toggleHidden()"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="block h-6 w-6 cursor-pointer"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              ></path>
            </svg>
          </button>

          <div
            id="mainSiteNav"
            class="fixed left-0 top-20 hidden h-screen w-full bg-slate-100/95 xl:relative xl:left-auto xl:top-0 xl:flex xl:h-auto xl:w-auto xl:items-center xl:bg-transparent"
            aria-hidden="true"
          >
            <ul
              id="menuContainer"
              class="text-white-700 flex w-full flex-col items-center p-2 text-right text-base xl:h-full xl:flex-row xl:items-center xl:justify-between xl:px-0 dark:text-teal-300"
            >
              <li id="search" class="flex items-center">
                <div class="align-center mr-1 max-w-[480px] px-1">
                  <form action="/search">
                    <div class="relative flex">
                      <input
                        type="text"
                        name="query"
                        class="h-10 w-full rounded-md border p-4 shadow dark:border-gray-700 dark:bg-gray-200 dark:text-gray-800"
                        placeholder="Search Articles"
                      />
                      <button type="submit">
                        <svg
                          class="absolute right-3 top-2.5 h-5 w-5 fill-current text-teal-400 dark:text-teal-300"
                          xmlns="http://www.w3.org/2000/svg"
                          xmlns:xlink="http://www.w3.org/1999/xlink"
                          version="1.1"
                          x="0px"
                          y="0px"
                          viewBox="0 0 56.966 56.966"
                          style="enable-background: new 0 0 56.966 56.966"
                          xml:space="preserve"
                        >
                          <path
                            d="M55.146,51.887L41.588,37.786c3.486-4.144,5.396-9.358,5.396-14.786c0-12.682-10.318-23-23-23s-23,10.318-23,23  s10.318,23,23,23c4.761,0,9.298-1.436,13.177-4.162l13.661,14.208c0.571,0.593,1.339,0.92,2.162,0.92  c0.779,0,1.518-0.297,2.079-0.837C56.255,54.982,56.293,53.08,55.146,51.887z M23.984,6c9.374,0,17,7.626,17,17s-7.626,17-17,17  s-17-7.626-17-17S14.61,6,23.984,6z"
                          ></path>
                        </svg>
                      </button>
                    </div>
                  </form>
                </div>
              </li> 

              <li>
                <a
                  class="m-2 block px-2 py-4 transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                  href="/"
                >
                  Home
                </a>
              </li>
              <li>
                <a
                  class="m-2 block px-2 py-4 transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                  href="/repository"
                  >Repository</a
                >
              </li>
              <li>
                <a
                  class="m-2 block px-2 py-4 transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                  href="/dashboard"
                  >Dashboard</a
                >
              </li>

              {% if logged_in %} 
                {% if "LIBRARYMANAGER" in roles %}
                <li
                  class="group relative m-2 block px-2 py-4 tracking-wide transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                >
                  <a>Duplicate</a>
                  <!-- Submenu -->
                  <div
                    class="absolute right-0 mt-4 hidden h-auto group-hover:block"
                  >
                    <ul class="w-56 bg-slate-600/90 xl:items-center">
                      <li class="py-1">
                        <a
                          href="/duplicate/title"
                          class="m-2 block px-2 py-4 transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                          >Duplicate by Title</a
                        >
                      </li>
                      <li class="py-1">
                        <a
                          href="/duplicate/pubmed_id"
                          class="m-2 block px-2 py-4 transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                          >Duplicate by PubMed ID</a
                        >
                      </li>
                      <li class="py-1">
                        <a
                          href="/duplicate/pmc_id"
                          class="m-2 block px-2 py-4 transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                          >Duplicate by PMC ID</a
                        >
                      </li>
                      <li class="py-1">
                        <a
                          href="/duplicate/doi"
                          class="m-2 block px-2 py-4 transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                          >Duplicate by DOI</a
                        >
                      </li>
                    </ul>
                  </div>
                </li>
                {% endif%}

                <li
                  class="group relative m-2 block px-2 py-4 tracking-wide transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                >
                  <a>{{ user.firstname }}</a>
                  <!-- Submenu -->
                  <div
                    class="absolute right-0 mt-4 hidden h-auto group-hover:block"
                  >
                    <ul class="w-56 bg-slate-600/90 xl:items-center">
                      {% if "FACULTY" in roles or "SCIENTIST" in roles  %}
                        <li class="py-1">
                          <a
                            href="/home"
                            class="m-2 block px-2 py-4 transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                            >Upload Articles</a
                          >
                        </li>
                      {% endif %}
                      {% if "FACULTY" in roles or "SCIENTIST" in roles or "RESIDENT" in roles %}
                      <li class="py-1">
                        <a
                          href="/ownership"
                          class="m-2 block px-2 py-4 transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                          >Identify your articles</a
                        >
                      </li>
                      {% endif %}
                      {% if "FACULTY" in roles or "SCIENTIST" in roles or "RESIDENT" in roles %}
                      <li class="py-1">
                        <a
                          href="/author?q={{user.employee_id}}"
                          class="m-2 block px-2 py-4 transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                          >My Articles</a
                        >
                      </li>
                      {% endif %}
                      <li class="py-1">
                        <a
                          class="m-2 block px-2 py-4 transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                          href="#"
                          onclick="logout()"
                          >Logout</a
                        >
                      </li>
                    </ul>
                  </div>
                </li>
              {% else %}
                <li>
                  <a
                    class="m-2 block px-2 py-4 transition duration-300 ease-out hover:bg-gray-600 hover:text-slate-200 hover:ease-in-out xl:m-0 xl:px-4"
                    href="/login"
                    >Log In</a
                  >
                </li>
              {% endif%}
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <main class="container mx-auto min-h-screen px-4 pt-4">
      {% block content %} {% endblock %}
    </main>

    <footer
      class="bg-slate-200 text-gray-700 dark:bg-slate-700 dark:text-teal-300"
    >
      <div
        class="container mx-auto flex w-full flex-wrap items-center justify-between p-4"
        id="footerContainedContent"
      >
        <aside>
          <h2>
            AIIMS Research Repository.
            <br />
            AIIMS New Delhi, (c) 2024
            <br />
            All Rights Reserved
          </h2>
        </aside>

        <!-- <nav>
          <h6 class="footer-title">Legal</h6>
          <a class="link link-hover">Terms of use</a>
          <a class="link link-hover">Privacy policy</a>
          <a class="link link-hover">Cookie policy</a>
        </nav> -->
        <nav>
          <span>Mode</span>
          <button aria-label="toggle theme" onClick="toggle_theme()">
            {% include 'sunicon.html' %}
          </button>
        </nav>
      </div>
    </footer>
  </body>
  <script src="{{url_for('static',filename='js/common.js')}}"></script>
  <script src="{{url_for('static',filename='js/toastify.js')}}"></script>

  <script>
    const menu = document.getElementById("mainSiteNav");
    const menuButton = document.getElementById("mainSiteNavToggle");

    document.addEventListener("click", (event) => {
      if (!menu.contains(event.target) && !menuButton.contains(event.target)) {
        menu.classList.add("hidden");
      }
    });

    function toggleHidden() {
      menu.classList.toggle("hidden");
    }

    function toggle_theme() {
      let saved_theme = localStorage.getItem("theme");
      let prefersDarkMode = window.matchMedia(
        "(prefers-color-scheme: dark)",
      ).matches;

      if (saved_theme == null) {
        console.log(
          "No saved theme. Now set a theme opposite to system preference",
        );
        let themeToSet = prefersDarkMode ? "light" : "dark";
        console.log("set theme to ", themeToSet);
        localStorage.setItem("theme", themeToSet);
        if (themeToSet === "dark") {
          document.getElementsByTagName("html")[0].classList.add("dark");
          console.log("Added Class  ", themeToSet);
        } else {
          document.getElementsByTagName("html")[0].classList.remove("dark");
          console.log("Removed Class  ", "dark");
        }
      } else {
        let themeToSet = saved_theme === "dark" ? "light" : "dark";
        console.log(
          "saved theme -- ",
          saved_theme,
          "--Now set a theme opposite to saved theme preference--",
          themeToSet,
        );
        localStorage.setItem("theme", themeToSet);

        if (themeToSet === "dark") {
          document.getElementsByTagName("html")[0].classList.add("dark");
          console.log("Added Class  ", themeToSet);
        } else {
          document.getElementsByTagName("html")[0].classList.remove("dark");
          console.log("Removed Class  ", "Dark");
        }
      }
    }
  </script>
</html>
